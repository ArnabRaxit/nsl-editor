  <%#= "#{pluralize(@search.executed_query.count,"record")}." %>
  <%#= link_to(%Q("#{@search.parsed_request.query_string}" #{icon('refresh')}).html_safe, search_path(query_string: "#{@search.parsed_request.query_string}",query_target: "#{params[:query_target]}"), title: 'Rerun the query.') %>

 <span id="set-include-common-and-cultivar">
   <%= render partial: 'set_include_common_and_cultivar' %>
 </span>
<% unless @search.empty == true %>
 &nbsp;|&nbsp;
<% end %>
<% if @search.error %>
  <%= @search.error_message %>
<% elsif @search.empty %>
<% else %>
    <% if @search.parsed_request.count %> 
      <%= "#{pluralize(@search.executed_query.count,@search.parsed_request.target_table||'record')}" %>
    <% else %>
      <% if @search.executed_query.count == 0 %>
        <% records_found = false %>
        No records found. 
      <% else %>
        <% records_found = true %>
        <% if @search.parsed_request.defined_query %>
          <%= "#{pluralize(@search.executed_query.count,"record")}" %>
          <% if @search.executed_query.results.present? && @search.executed_query.results.size >= @search.parsed_request.limit %>
            of an unknown total
            <strong title="Limited.  To see more records add larger limit to the search e.g. ' limit: 999'." >(limited)</strong>
          <% end %>
        <% else %>
          <%# if @search.executed_query.results.size == @search.parsed_request.limit %>
          <% if @search.executed_query.results.size == @search.parsed_request.limit %>
            <% total = @search.executed_query.results.except(:offset,:limit,:order).count %>
            <%= "#{pluralize(@search.executed_query.results.size,"of #{total} record")}" %>
          <% else %>
            <% total = @search.executed_query.results.size %>
            <%= "#{pluralize(@search.executed_query.results.size,"record")}" %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>


          &nbsp; | &nbsp;
    <%= link_to(%Q(#{@search.parsed_request.query_target.capitalize} "#{@search.parsed_request.query_string}" ).html_safe, search_path(query_string: "#{@search.parsed_request.query_string}",query_target: "#{params[:query_target]}"), title: 'Rerun the query.') %>


    <% if !@search.parsed_request.count && total.present? && total > @search.parsed_request.limit %>
      <span id="search-results-limited-notice">
        <% next_limit_max = (@search.executed_query.results.size + @search.page_increment_size) %>
        <% if total <= next_limit_max %>
          &nbsp; | &nbsp;
          <%= link_to("All", search_path(query_string: "#{@search.parsed_request.query_string.sub(/limit: *\d+/i,'').sub(/$/,%Q( limit: #{total} ))}",query_target: "#{params[:query_target]}"), title: "List all.") %>
        <% else %>
          &nbsp; | &nbsp;
          <%= link_to("List #{next_limit_max}", search_path(query_string: "#{@search.parsed_request.query_string.sub(/limit: *\d{1,}/,'').sub(/$/,%Q(limit: #{next_limit_max} ))}",query_target: "#{params[:query_target]}"), title: "List #{@search.page_increment_size} more.") %>
        <% end %>
        <% if @search.more_allowed %>
          &nbsp; | &nbsp;
          <%= link_to('List more', search_path(query_string: "#{@search.parsed_request.query_string_for_more}",query_target: "#{params[:query_target]}"), title: 'List more.') %>
        <% end %>
        <% if @search.parsed_request.count_allowed %>
          &nbsp; | &nbsp;
          <%= link_to('Count', 
                      search_path(query_string: "count #{@search.parsed_request.query_string.sub(/^ *list */i,'')}",
                                  query_target: "#{params[:query_target]}"),
                      title: "Re-run the query as a count query") %>
        <% end %>
      </span>
    <% end %>
    <% if @search.parsed_request.count && @search.executed_query.count > 0 %> 
       &nbsp; | &nbsp;
       <%= link_to('List', 
                   search_path(query_string: "#{@search.parsed_request.query_string.sub(/^ *count */i,'')}",
                   query_target: "#{params[:query_target]}"),
                   title:"Re-run query as a list query" ) %>
    <% end %>

 <% end %>

<%#= @search.parsed_request.inspect %>
